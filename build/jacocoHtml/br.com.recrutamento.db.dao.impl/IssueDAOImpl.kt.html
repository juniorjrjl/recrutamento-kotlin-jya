<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IssueDAOImpl.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">recrutamento-kotlin-jya</a> &gt; <a href="index.source.html" class="el_package">br.com.recrutamento.db.dao.impl</a> &gt; <span class="el_source">IssueDAOImpl.kt</span></div><h1>IssueDAOImpl.kt</h1><pre class="source lang-java linenums">package br.com.recrutamento.db.dao.impl

import br.com.recrutamento.db.dao.IIssueDAO
import br.com.recrutamento.db.table.Issues
import br.com.recrutamento.db.util.ConversaoDados
import br.com.recrutamento.dto.IssueAtualizacaoDTO
import br.com.recrutamento.dto.IssueCadastroDTO
import br.com.recrutamento.dto.IssueDetalhadaDTO
import br.com.recrutamento.dto.IssueStatusEnum
import org.jetbrains.exposed.sql.deleteWhere
import org.jetbrains.exposed.sql.insert
import org.jetbrains.exposed.sql.select
import org.jetbrains.exposed.sql.update
import org.joda.time.DateTime
import java.time.LocalDateTime

<span class="nc" id="L17">class IssueDAOImpl  : IIssueDAO {</span>

    override fun cadastrar(dto: IssueCadastroDTO){
<span class="nc" id="L20">        Issues.insert {</span>
<span class="nc" id="L21">            it[number] = dto.number</span>
<span class="nc" id="L22">            it[title] = dto.title</span>
<span class="nc" id="L23">            it[body] = dto.body</span>
<span class="nc" id="L24">            it[state] = dto.state.id</span>
<span class="nc" id="L25">            it[createdAt] = ConversaoDados.gerarDateTime(dto.createdAt)</span>
<span class="nc" id="L26">            it[updatedAt] = ConversaoDados.gerarDateTime(dto.updatedAt)</span>
<span class="nc" id="L27">            it[closedAt] = ConversaoDados.gerarDateTime(dto.closedAt)</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">            it[userName] = dto.userName?:&quot;&quot;</span>
<span class="nc" id="L29">            it[idGitHub] = dto.idGitHub</span>
<span class="nc" id="L30">        }</span>
<span class="nc" id="L31">    }</span>

    override fun atualizar(dto: IssueAtualizacaoDTO){
<span class="pc" id="L34">        Issues.update({Issues.idGitHub eq dto.idGitHub}){</span>
<span class="fc" id="L35">            it[Issues.title] = dto.title</span>
<span class="fc" id="L36">            it[Issues.body] = dto.body</span>
<span class="fc" id="L37">            it[Issues.state] = dto.state.id</span>
<span class="fc" id="L38">            it[Issues.updatedAt] = ConversaoDados.gerarDateTime(dto.updatedAt)</span>
<span class="fc" id="L39">        }</span>
<span class="nc" id="L40">    }</span>

    override fun atualizarDataFechamento(closedAt: LocalDateTime?, status: IssueStatusEnum, idGitHub: Long){
<span class="pc" id="L43">        Issues.update({Issues.idGitHub eq idGitHub}){</span>
<span class="fc" id="L44">            it[Issues.closedAt] = ConversaoDados.gerarDateTime(closedAt)</span>
<span class="fc" id="L45">            it[Issues.state] = status.id</span>
<span class="fc" id="L46">        }</span>
<span class="nc" id="L47">    }</span>

    override fun atualizarDataAtualizacao(updatedAt: LocalDateTime, status: IssueStatusEnum, idGitHub: Long){
<span class="pc" id="L50">        Issues.update({Issues.idGitHub eq idGitHub}){</span>
<span class="fc" id="L51">            it[Issues.updatedAt] = ConversaoDados.gerarDateTime(updatedAt)</span>
<span class="fc" id="L52">            it[Issues.state] = status.id</span>
<span class="fc" id="L53">        }</span>
<span class="nc" id="L54">    }</span>

    override fun excluirPorIdGitHub(idGitHub: Long){
<span class="pc" id="L57">        Issues.deleteWhere { Issues.idGitHub eq idGitHub}</span>
<span class="nc" id="L58">    }</span>

    override fun buscarDetalhes(number: Long): IssueDetalhadaDTO?{
<span class="nc" id="L61">        var dto : IssueDetalhadaDTO? = null</span>
<span class="nc" id="L62">        try {</span>
<span class="nc" id="L63">            val retorno: Pair&lt;Pair&lt;Pair&lt;Pair&lt;Pair&lt;Pair&lt;Pair&lt;Pair&lt;Long, Long?&gt;, String?&gt;, String?&gt;, Int?&gt;, DateTime?&gt;, DateTime?&gt;, DateTime?&gt;, String?&gt;</span>
<span class="nc" id="L64">            retorno = Issues.slice(</span>
<span class="nc" id="L65">                Issues.id,</span>
<span class="nc" id="L66">                Issues.number,</span>
<span class="nc" id="L67">                Issues.title,</span>
<span class="nc" id="L68">                Issues.body,</span>
<span class="nc" id="L69">                Issues.state,</span>
<span class="nc" id="L70">                Issues.createdAt,</span>
<span class="nc" id="L71">                Issues.updatedAt,</span>
<span class="nc" id="L72">                Issues.closedAt,</span>
<span class="nc" id="L73">                Issues.userName</span>
            )
<span class="nc" id="L75">                .select { Issues.number eq number }</span>
<span class="nc" id="L76">                .map {</span>
<span class="nc" id="L77">                    it[Issues.id] to</span>
<span class="nc" id="L78">                    it[Issues.number] to</span>
<span class="nc" id="L79">                    it[Issues.title] to</span>
<span class="nc" id="L80">                    it[Issues.body] to</span>
<span class="nc" id="L81">                    it[Issues.state] to</span>
<span class="nc" id="L82">                    it[Issues.createdAt] to</span>
<span class="nc" id="L83">                    it[Issues.updatedAt] to</span>
<span class="nc" id="L84">                    it[Issues.closedAt] to</span>
<span class="nc" id="L85">                    it[Issues.userName]</span>
<span class="nc" id="L86">                }.single()</span>
<span class="nc" id="L87">            dto = IssueDetalhadaDTO(</span>
<span class="nc" id="L88">                retorno.first.first.first.first.first.first.first.first,</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">                retorno.first.first.first.first.first.first.first.second ?: 0,</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">                retorno.first.first.first.first.first.first.second ?: &quot;&quot;,</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">                retorno.first.first.first.first.first.second ?: &quot;&quot;,</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                ConversaoDados.gerarStatusIssue(retorno.first.first.first.first.second ?: 1),</span>
<span class="nc" id="L93">                ConversaoDados.gerarLocalDateTime(retorno.first.first.first.second),</span>
<span class="nc" id="L94">                ConversaoDados.gerarLocalDateTime(retorno.first.first.second),</span>
<span class="nc" id="L95">                ConversaoDados.gerarLocalDateTime(retorno.first.second),</span>
<span class="nc" id="L96">                retorno.second</span>
            )
<span class="nc" id="L98">        }catch (ex: NoSuchElementException){ }</span>
<span class="nc" id="L99">        return dto</span>
    }

    override fun buscarIdIssue(idGitHub: Long): Long? {
<span class="nc" id="L103">        var retorno: Long? = null</span>
<span class="nc" id="L104">        try {</span>
<span class="nc" id="L105">            retorno = Issues.slice(Issues.id)</span>
<span class="nc" id="L106">                .select { Issues.idGitHub eq idGitHub }</span>
<span class="nc" id="L107">                .map { it[Issues.id] }</span>
<span class="nc" id="L108">                .single()</span>
<span class="nc" id="L109">        }catch (ex: NoSuchElementException){ }</span>
<span class="nc" id="L110">        return retorno</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>